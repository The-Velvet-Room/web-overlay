/*!
 * OBS Remote JS API v1.0.1 (https://github.com/nodecg/obs-remote-js)
 * Copyright 2014 Matthew McNamara <matt@mattmcn.com>
 * Licensed under MIT (https://github.com/nodecg/obs-remote-js/blob/master/LICENSE)
 */
!function(){"use strict";function a(a,b,c,d,e,f){this.width=a||0,this.height=b||0,this.x=c||0,this.y=d||0,this.name=e||"",this.rendered=f||!1}"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports.OBSSource=a:window.OBSSource=a}(),function(){"use strict";function a(a,b){this.name=a||"",this.sources=b||[]}"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports.OBSScene=a:window.OBSScene=a}(),function(){"use strict";function a(){a.API_VERSION=1.1,a.DEFAULT_PORT=4444,a.WS_PROTOCOL="obsapi",this._connected=!1,this._socket=void 0,this._messageCounter=0,this._responseCallbacks={},this._auth={salt:"",challenge:""}}function b(a){return unescape(encodeURIComponent(a))}function c(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b.buffer}function d(a){for(var b="",c=new Uint8Array(a),d=c.byteLength,e=0;d>e;e++)b+=String.fromCharCode(c[e]);return btoa(b)}function e(a){var b=a.name,c=[];return a.sources.forEach(function(a){c.push(f(a))}),new h(b,c)}function f(a){return new g(a.cx,a.cy,a.x,a.y,a.name,a.render)}var g={},h={};"undefined"!=typeof module&&"undefined"!=typeof module.exports?(h=module.exports.OBSScene,g=module.exports.OBSSource):(h=window.OBSScene,g=window.OBSSource);var i={},j={};if("undefined"!=typeof module&&"undefined"!=typeof module.exports)i=require("crypto"),a.prototype._authHash=a.prototype._nodeCryptoHash,j=require("ws");else{if(i=window.crypto||window.msCrypto||{},a.prototype._authHash=a.prototype._webCryptoHash,"undefined"==typeof i.subtle)if("undefined"==typeof i.webkitSubtle){if("undefined"==typeof CryptoJS)throw new Error("OBS Remote requires CryptoJS when native crypto is not available!");a.prototype._authHash=a.prototype._cryptoJSHash}else i.subtle=i.webkitSubtle;j=window.WebSocket}a.prototype.connect=function(b,c){c="undefined"==typeof c?"":c,b="undefined"==typeof b||""===b?"localhost":b;var d=b.indexOf(":");(0>d||d===b.length-1)&&(b+=":"+a.DEFAULT_PORT),this._connected&&(this._socket.close(),this._connected=!1),this._socket="undefined"!=typeof module&&"undefined"!=typeof module.exports?new j("ws://"+b,{protocol:a.WS_PROTOCOL}):new j("ws://"+b,a.WS_PROTOCOL);var e=this;this._socket.onopen=function(){e._connected=!0,e.onConnectionOpened(),e.isAuthRequired(function(a){a&&e.authenticate(c)})},this._socket.onclose=function(){e.onConnectionClosed(),e._connected=!1},this._socket.onerror=function(a){e.onConnectionFailed(a),e._connected=!1},this._socket.onmessage=function(a){e._messageReceived(a)}},a.prototype.authenticate=function(a){var b=this;this._authHash(a,function(a){function c(a){var c="ok"===a.status,d=0;c?b.onAuthenticationSucceeded():(d=a.error.substr(43),b.onAuthenticationFailed(d))}b._sendMessage("Authenticate",{auth:a},c)})},a.prototype.toggleStream=function(a){a="undefined"==typeof a?!1:a,this._sendMessage("StartStopStreaming",{"preview-only":a})},a.prototype.getVersion=function(a){function b(b){a(b.version)}this._sendMessage("GetVersion",b)},a.prototype.isAuthRequired=function(a){function b(b){var d=b.authRequired;d&&(c._auth.salt=b.salt,c._auth.challenge=b.challenge),a(d)}var c=this;this._sendMessage("GetAuthRequired",b)},a.prototype.getSceneList=function(a){function b(b){var c=b["current-scene"],d=[];b.scenes.forEach(function(a){d.push(e(a))}),a(c,d)}this._sendMessage("GetSceneList",b)},a.prototype.getCurrentScene=function(a){function b(b){var c=e(b);a(c)}this._sendMessage("GetCurrentScene",b)},a.prototype.setCurrentScene=function(a){this._sendMessage("SetCurrentScene",{"scene-name":a})},a.prototype.setSourcesOrder=function(a){var b=a;a[1]instanceof"OBSSource"&&(b=[],a.forEach(function(a){b.push(a.name)})),this._sendMessage("SetSourcesOrder",{"scene-names":b})},a.prototype.setSourceRender=function(a,b){this._sendMessage("SetSourceRender",{source:a,render:b})},a.prototype.getStreamingStatus=function(a){function b(b){a(b.streaming,b["preview-only"])}this._sendMessage("GetStreamingStatus",b)},a.prototype.getVolumes=function(a){function b(b){a(b["mic-volume"],b["mic-muted"],b["desktop-volume"],b["desktop-muted"])}this._sendMessage("GetVolumes",b)},a.prototype.setMicrophoneVolume=function(a,b){this._sendMessage("SetVolume",{channel:"microphone",volume:a,"final":!b})},a.prototype.toggleMicrophoneMute=function(){this._sendMessage("ToggleMute",{channel:"microphone"})},a.prototype.setDesktopVolume=function(a,b){this._sendMessage("SetVolume",{channel:"desktop",volume:a,"final":!b})},a.prototype.toggleDesktopMute=function(){this._sendMessage("ToggleMute",{channel:"desktop"})},a.prototype.onConnectionOpened=function(){},a.prototype.onConnectionClosed=function(){},a.prototype.onConnectionFailed=function(){},a.prototype.onAuthenticationSucceeded=function(){},a.prototype.onAuthenticationFailed=function(){},a.prototype.onStreamStarted=function(){},a.prototype.onStreamStopped=function(){},a.prototype.onStatusUpdate=function(){},a.prototype.onSceneSwitched=function(){},a.prototype.onScenesChanged=function(){},a.prototype.onSourceOrderChanged=function(){},a.prototype.onSourceAddedOrRemoved=function(){},a.prototype.onSourceChanged=function(){},a.prototype.onMicrophoneVolumeChanged=function(){},a.prototype.onDesktopVolumeChanged=function(){},a.prototype._sendMessage=function(a,b,c){if(this._connected){var d=this._getNextMsgId();"function"==typeof b&&(c=b,b={}),b=b||{},c=c||function(){},this._responseCallbacks[d]=c,b["message-id"]=d,b["request-type"]=a;var e=JSON.stringify(b);this._socket.send(e)}},a.prototype._getNextMsgId=function(){return this._messageCounter+=1,this._messageCounter+""},a.prototype._messageReceived=function(a){var b=JSON.parse(a.data);if(b){var c=this,d=b["update-type"];if(d)switch(d){case"StreamStarting":this.onStreamStarted(b["preview-only"]);break;case"StreamStopping":this.onStreamStopped(b["preview-only"]);break;case"SwitchScenes":this.onSceneSwitched(b["scene-name"]);break;case"StreamStatus":this.onStatusUpdate(b.streaming,b["preview-only"],b["bytes-per-sec"],b.strain,b["total-stream-time"],b["num-total-frames"],b["num-dropped-frames"],b.fps);break;case"ScenesChanged":this.getSceneList(function(a,b){c.onScenesChanged(b)});break;case"SourceOrderChanged":this.getCurrentScene(function(a){c.onSourceOrderChanged(a.sources)});break;case"RepopulateSources":var e=[];b.sources.forEach(function(a){e.push(f(a))}),this.onSourceAddedOrRemoved(e);break;case"SourceChanged":this.onSourceChanged(b["source-name"],f(b.source));break;case"VolumeChanged":var g="desktop"===b.channel?this.onDesktopVolumeChanged:this.onMicrophoneVolumeChanged;g(b.volume,b.muted,!b.finalValue);break;default:console.warn("[OBSRemote] Unknown OBS update type:",d,", full message:",b)}else{var h=b["message-id"];"error"===b.status&&console.error("[OBSRemote] Error:",b.error);var i=this._responseCallbacks[h];i(b),delete this._responseCallbacks[h]}}},a.prototype._webCryptoHash=function(a,e){var f=b(a),g=b(this._auth.salt),h=c(f+g),j=this;i.subtle.digest("SHA-256",h).then(function(a){var f=b(d(a)),g=b(j._auth.challenge),h=c(f+g);i.subtle.digest("SHA-256",h).then(function(a){var b=d(a);e(b)})})},a.prototype._cryptoJSHash=function(a,c){var d=b(a),e=b(this._auth.salt),f=CryptoJS.SHA256(d+e).toString(CryptoJS.enc.Base64),g=b(f),h=b(this._auth.challenge),i=CryptoJS.SHA256(g+h).toString(CryptoJS.enc.Base64);c(i)},a.prototype._nodeCryptoHash=function(a,c){var d=i.createHash("sha256"),e=b(a),f=b(this._auth.salt);d.update(e+f);var g=d.digest("base64"),h=i.createHash("sha256"),j=b(g),k=b(this._auth.challenge);h.update(j+k);var l=h.digest("base64");c(l)},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=a:window.OBSRemote=a}();